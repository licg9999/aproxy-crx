var PROTPORTS={http:"80",https:"443"},RemoteHosts={"g.alicdn.com":!0,"g-assets.daily.taobao.net":!0,"g.tbcdn.cn":!0,"g.assets.daily.taobao.net":!0},RemotePrPts={http:"80",https:"443"},ProxyAddrs={"127.0.0.1":!0},ProxyPrPts={http:"80",https:"443"},ProxyHosts={"127.0.0.1:9999":!0},ProxyStats={started:!1};define("main",function(a){a("_"),a("URI");var b=a("object"),c=a("nw"),d=b.create({initialize:function(){var a=this;setInterval(function(){c.json({url:"/ping",timeout:200},function(b,c){b||!c.success?ProxyStats.started&&(ProxyStats.started=!1,chrome.browserAction.setIcon({path:"./imgs/icon_disabled.png"}),a.trigger("stop")):ProxyStats.started||(ProxyStats.started=!0,chrome.browserAction.setIcon({path:"./imgs/icon_128.png"}),a.trigger("start"))})},1e3)}});window.notifier=d;b.create({formatUrlPars:function(a){return a.port||(a.port=PROTPORTS[a.protocol]),a},normalUrlPars:function(a){return a.port===PROTPORTS[a.protocol]&&(a.port=null),a},onBeforeRequest:function(a){console.log("a");var b=this,c=b.formatUrlPars(URI.parse(a.url));return RemoteHosts[c.hostname]&&c.port===RemotePrPts[c.protocol]&&(c.hostname=_.keys(ProxyAddrs)[0],c.port=ProxyPrPts[c.protocol]),b.normalUrlPars(c),{redirectUrl:URI.build(c)}},onBeforeSendHeaders:function(a){console.log("b");var b=this,c=b.formatUrlPars(URI.parse(a.url));return ProxyAddrs[c.hostname]&&c.port===ProxyPrPts[c.protocol]?(a.requestHeaders.push({name:"ahost",value:_.keys(RemoteHosts)[0]+":"+RemotePrPts[c.protocol]}),{requestHeaders:a.requestHeaders}):void 0},onStart:function(){var a=this;chrome.webRequest.onBeforeRequest.addListener(a.onBeforeRequest,{urls:["http://*/*","https://*/*"]},["blocking"]),chrome.webRequest.onBeforeSendHeaders.addListener(a.onBeforeSendHeaders,{urls:["http://*/*","https://*/*"]},["blocking","requestHeaders"])},onStop:function(){var a=this;chrome.webRequest.onBeforeRequest.removeListener(a.onBeforeRequest),chrome.webRequest.onBeforeSendHeaders.removeListener(a.onBeforeSendHeaders)},initialize:function(){var a=this;d.on("start",a.onStart).on("stop",a.onStop)}})}),seajs.use("main");